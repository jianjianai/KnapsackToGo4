import java.text.SimpleDateFormat

plugins {
    id 'java'
    id "org.spongepowered.gradle.plugin" version "2.0.2"
}

compileJava.options.encoding = 'UTF-8'
//设置版本号
String versions = new SimpleDateFormat("yyMM.dd.HHmm").format(new Date());//"0.03"//
version = versions

group 'cn.jja8.knapsackToGo4'

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
}


sponge {
    apiVersion("8.0.0")
    loader {
        name("java_plain")
        version("1.0")
    }
    plugin("knapsacktogo4"){
        displayName("KnapsackToGo4")
        entrypoint("cn.jja8.knapsackToGo4.sponge.KnapsackToGo4")
        description("强大的跨服数据同步插件第4代。")
        links {
            homepage("https://gitee.com/jja8/KnapsackToGo4")
            source("https://gitee.com/jja8/KnapsackToGo4/releases")
            issues("https://gitee.com/jja8/KnapsackToGo4/issues")
        }
        contributor("jianjianai") {
            description("简简爱")
        }
    }
    license("CHANGEME")
}

dependencies {
    implementation project(":all")
//    compileOnly 'org.spongepowered:spongeapi:8.0.0'
    implementation 'com.esotericsoftware.yamlbeans:yamlbeans:1.15'
}

test {
    useJUnitPlatform()
}

jar{
    //将依赖植入jar包
    from {
        configurations.runtimeClasspath.collect {
            setDuplicatesStrategy(DuplicatesStrategy.EXCLUDE)
            it.isDirectory() ? it : zipTree(it)
        }
    }
}

jar.doLast{

    new File(new File(getBuildDir(),getLibsDirName()),project.name+"-"+version+".jar")
            .renameTo(
                    new File(new File(getBuildDir(),getLibsDirName()),"knapsackToGo4-"+project.name+"-"+version+".jar")
            )
}